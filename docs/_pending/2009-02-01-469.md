---
title: "SSH en Gentoo"
date: "2009-02-01"
categories: 
  - "gentoo"
tags: 
  - "linux"
  - "ssh"
---

[![ssh](https://www.luispa.com/wp-content/uploads/2014/12/ssh.jpg)](https://www.luispa.com/wp-content/uploads/2014/12/ssh.jpg)El servicio SSH es lo primero que deberías configurar en un sistema Linux. Con OpenSSH tienes un conjunto de herramientas, entre ellas ssh, sshd, scp, etc. que te permiten activar la posibilidad de acceder mediante una Shell Segura remota a tu equipo. Si vienes de la epoca del "telnet" deberías olvidarte de él, el sustituto hoy en día es SSH.

## Servidor

Instalación en Gentoo: emerge -v openssh Arranque en Gentoo: /etc/init.d/sshd start Arranque durante el boot en Gentoo: rc-update add sshd default

Para cambiar el comportamiento por defecto echa un ojo al archivo /etc/ssh/sshd\_config antes de arrancar SSH. En mi caso impido el login como root (PermitRootLogin), impido el uso de PAM (UsePAM) y tampoco prohibo el uso de una password normal de usuario (PasswordAuthentication), de esta forma solo nos queda el uso de una pareja de claves pública/privada :-)

Port 22
PermitRootLogin no
PasswordAuthentication no
UsePAM no
X11Forwarding yes
PrintMotd no
PrintLastLog no
UsePrivilegeSeparation sandbox # Default for new installations.
Subsystem sftp /usr/lib64/misc/sftp-server
AcceptEnv LANG LC\_\*

## Cliente

Veamos cómo generar la pareja de claves privada/pública, de tipo RSA. En el ordenador "cliente" generamos la pareja:

 
 
pepe@pccliente ~ $ ssh-keygen -t rsa -b 2048
Generating public/private rsa key pair.
Enter file in which to save the key (/home/pepe/.ssh/id\_rsa):
Enter passphrase (empty for no passphrase): <==== Contraseña
Se generan dos ficheros en "pccliente" en /home/pepe/.ssh/

pepe@pccliente ~ $ ls -al .ssh/
drwx------ 2 luis luis 136 Feb 1 17:40 .
drwxr-xr-x 4 luis luis 256 Feb 1 00:38 ..
-rw------- 1 luis luis 1743 Feb 1 17:40 id\_rsa
-rw-r--r-- 1 luis luis 393 Feb 1 17:40 id\_rsa.pub
 

Además, en el equipo cliente también tenemos que configurar el fichero de configuración SSH (en el caso de Gentoo está en /etc/ssh/ssh\_config), lo configuro para permitir forwarding de X11.

Host pccservidor pcservidor.midominio.com
 ForwardAgent yes
 ForwardX11 yes
 ForwardX11Trusted yes

## Enviar el fichero id\_rsa.pub al Servidor

El siguiente paso consiste en instalar la clave pública (está en el fichero id\_rsa.pub) en el directorio HOME/.ssh del usuario con el que intentaremos conectar en el Servidor. Hay que añadir el contenido del fichero de clave pública del cliente (/home/pepe/.ssh/id\_rsa.pub) al fichero $HOME/.ssh/authorized\_keys del usuario con el que intentaremos hacer login en el servidor.

Enviamos por "algún método" el fichero id\_rsa.pub al servidor

:
pepe@pcservidor ~ $ cat /tmp/pepe-pccliente-id\_rsa.pub >> .ssh/authorized\_keys

# Conectar desde el cliente

Conexión desde el cliente. Volvemos al "pccliente" y pedimos una conexión contra el servidor:

pepe@pccliente ~ $ ssh pcservidor.midominio.com
