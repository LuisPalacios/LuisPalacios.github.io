---
title: "SSH en Gentoo"
date: "2006-11-13"
categories: herramientas
tags: linux gentoo
excerpt_separator: <!--more-->
---

![logo rsync](/assets/img/posts/ssh.svg){: width="150px" height="127px" style="float:left; padding-right:25px" } 

El servicio SSH es lo primero que deberías configurar en un sistema Linux. Con OpenSSH tienes un conjunto de herramientas, entre ellas ssh, sshd, scp, etc. que te permiten activar la posibilidad de acceder mediante una Shell Segura remota a tu equipo. Si vienes de la epoca del "telnet" deberías olvidarte de él, el sustituto hoy en día es SSH.

<br clear="left"/>
<!--more-->

<br/>

## Servidor

Veamos las tres opciones más importantes

- Instalación en Gentoo: `emerge -v openssh` 
- Arranque en Gentoo: `/etc/init.d/sshd start`
- Arranque durante el boot en Gentoo: `rc-update add sshd default`

Para cambiar el comportamiento por defecto mira el archivo `/etc/ssh/sshd_config`antes de arrancar SSH. En mi caso impido el login como root (`PermitRootLogin`), impido el uso de PAM (`UsePAM`) y tampoco prohibo el uso de una password normal de usuario (`PasswordAuthentication`), de esta forma solo nos queda el uso de una pareja de claves pública/privada :-)

```
Port 22
PermitRootLogin no
PasswordAuthentication no
UsePAM no
X11Forwarding yes
PrintMotd no
PrintLastLog no
UsePrivilegeSeparation sandbox # Default for new installations.
Subsystem sftp /usr/lib64/misc/sftp-server
AcceptEnv LANG LC\_\*
```

<br/>


## Cliente

Veamos cómo generar la pareja de claves privada/pública, de tipo RSA. En el ordenador "cliente" generamos la pareja:

```zsh
pepe@pccliente ~ $ ssh-keygen -t rsa -b 2048
:
Se generan dos ficheros en "pccliente" en /home/pepe/.ssh/
```

Además, en el equipo cliente también tenemos que configurar el fichero de configuración SSH (en el caso de Gentoo está en `/etc/ssh/ssh_config`), lo configuro para permitir forwarding de X11.


```zsh
Host pccservidor pcservidor.midominio.com
 ForwardAgent yes
 ForwardX11 yes
 ForwardX11Trusted yes
```

<br/>


### Enviar el fichero id_rsa.pub al Servidor

El siguiente paso consiste en instalar la clave pública (está en el fichero `id_rsa.pub`) en el directorio `HOME/.ssh` del usuario con el que intentaremos conectar en el Servidor. Hay que añadir el contenido del fichero de clave pública del cliente (`/home/pepe/.ssh/id_rsa.pub`) al fichero `$HOME/.ssh/authorized_keys` del usuario con el que intentaremos hacer login en el servidor.

Enviamos por "algún método" el fichero `id_rsa.pub` al servidor

```zsh
pepe@pcservidor ~ $ cat /tmp/pepe-pccliente-id_rsa.pub >> .ssh/authorized_keys
```

<br/>

### Conectar desde el cliente

Conexión desde el cliente. Volvemos al "pc cliente" y pedimos una conexión contra el servidor:

```zsh
pepe@pccliente ~ $ ssh pcservidor.midominio.com
```